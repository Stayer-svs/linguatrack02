{% extends "app_vocab/base.html" %}

{% block title %}–ú–æ–π –°–ª–æ–≤–∞—Ä—å{% endblock %}

{% block extra_css %}
<style>
    .stats-bar {
        background: #f5f5f5;
        padding: 15px;
        border-radius: 8px;
        margin-bottom: 20px;
        text-align: center;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    .stats-item {
        display: inline-block;
        margin: 0 20px;
        padding: 10px 15px;
        background: white;
        border-radius: 6px;
        box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }

    .stats-number {
        font-size: 1.5em;
        font-weight: bold;
        color: #333;
    }

    .stats-label {
        font-size: 0.9em;
        color: #666;
        margin-top: 5px;
    }

    .sort-buttons {
        text-align: center;
        margin: 20px 0;
    }

    .sort-btn {
        padding: 8px 16px;
        margin: 0 5px;
        background: #f8f9fa;
        border: 1px solid #dee2e6;
        border-radius: 4px;
        cursor: pointer;
        transition: all 0.3s;
    }

    .sort-btn:hover {
        background: #e9ecef;
    }

    .sort-btn.active {
        background: #007bff;
        color: white;
        border-color: #007bff;
    }

    .words-table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 20px;
        background: white;
        box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        border-radius: 8px;
        overflow: hidden;
    }

    .words-table th {
        background: #f8f9fa;
        padding: 15px;
        text-align: left;
        font-weight: bold;
        color: #333;
        border-bottom: 2px solid #dee2e6;
    }

    .words-table td {
        padding: 12px 15px;
        border-bottom: 1px solid #dee2e6;
    }

    .words-table tr:hover {
        background: #f8f9fa;
    }

    .progress-badge {
        display: inline-block;
        padding: 4px 8px;
        border-radius: 12px;
        font-size: 0.8em;
        font-weight: bold;
    }

    .progress-new {
        background: #ffebee;
        color: #c62828;
    }

    .progress-learning {
        background: #fff3e0;
        color: #ef6c00;
    }

    .progress-learned {
        background: #e8f5e8;
        color: #2e7d32;
    }

    .action-buttons {
        display: flex;
        gap: 5px;
    }

    .btn {
        padding: 6px 12px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-size: 0.9em;
        transition: all 0.3s;
    }

    .review-btn {
        background: #ff9800;
        color: white;
    }

    .review-btn:hover {
        background: #f57c00;
    }

    .delete-btn {
        background: #f44336;
        color: white;
    }

    .delete-btn:hover {
        background: #d32f2f;
    }

    .tts-btn {
        background: none;
        border: none;
        cursor: pointer;
        font-size: 1.2em;
        padding: 5px;
        border-radius: 50%;
        transition: background-color 0.3s;
    }

    .tts-btn:hover {
        background-color: #f0f0f0;
    }

    .add-word-section {
        text-align: center;
        margin: 30px 0;
        padding: 20px;
        background: #f8f9fa;
        border-radius: 8px;
    }

    .add-btn {
        padding: 12px 24px;
        background: #28a745;
        color: white;
        border: none;
        border-radius: 6px;
        font-size: 1.1em;
        cursor: pointer;
        text-decoration: none;
        display: inline-block;
    }

    .add-btn:hover {
        background: #218838;
    }

    .import-export-buttons {
        display: flex;
        gap: 15px;
        justify-content: flex-end;
        margin-bottom: 20px;
    }

    .btn-export, .btn-import {
        padding: 10px 20px;
        border-radius: 6px;
        text-decoration: none;
        font-weight: bold;
        transition: all 0.3s;
    }

    .btn-export {
        background: #4CAF50;
        color: white;
    }

    .btn-export:hover {
        background: #45a049;
        transform: translateY(-2px);
    }

    .btn-import {
        background: #2196F3;
        color: white;
    }

    .btn-import:hover {
        background: #1976D2;
        transform: translateY(-2px);
    }

.btn-primary {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%) !important;
    color: white !important;
    padding: 10px 20px !important;
    border-radius: 6px !important;
    text-decoration: none !important;
    font-weight: bold !important;
    border: 2px solid transparent !important;
}

.btn-primary:hover {
    background: linear-gradient(135deg, #5a6fd8 0%, #6a4190 100%) !important;
    transform: translateY(-2px) !important;
}

</style>
{% endblock %}

{% block content %}
<!-- –ó–ê–ì–û–õ–û–í–û–ö –ò –ö–ù–û–ü–ö–ò –í –û–î–ù–û–ô –°–¢–†–û–ö–ï -->
<div style="display: flex; justify-content: space-between; align-items: center; margin: 20px 0;">
    <h1>üìö –ú–æ–π –°–ª–æ–≤–∞—Ä—å</h1>

    <div class="import-export-buttons" style="display: flex; gap: 15px;">
        <a href="{% url 'app_vocab:export_words' %}" class="btn btn-export">
            üì§ –≠–∫—Å–ø–æ—Ä—Ç –≤ CSV
        </a>
        <a href="{% url 'app_vocab:import_words' %}" class="btn btn-import">
            üì• –ò–º–ø–æ—Ä—Ç –∏–∑ CSV
        </a>
        <a href="{% url 'app_vocab:add_word' %}" class="btn btn-primary">
            ‚ûï –î–æ–±–∞–≤–∏—Ç—å —Å–ª–æ–≤–æ
        </a>
    </div>
</div>

<!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
<div class="stats-bar">
    <div class="stats-item">
        <div class="stats-number">{{ words_stats.total }}</div>
        <div class="stats-label">–í—Å–µ–≥–æ —Å–ª–æ–≤</div>
    </div>
    <div class="stats-item">
        <div class="stats-number">{{ words_stats.new }}</div>
        <div class="stats-label">–ù–æ–≤—ã–µ</div>
    </div>
    <div class="stats-item">
        <div class="stats-number">{{ words_stats.learning }}</div>
        <div class="stats-label">–í –ø—Ä–æ—Ü–µ—Å—Å–µ</div>
    </div>
    <div class="stats-item">
        <div class="stats-number">{{ words_stats.learned }}</div>
        <div class="stats-label">–ò–∑—É—á–µ–Ω–æ</div>
    </div>
</div>

<!-- –ö–Ω–æ–ø–∫–∏ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏ -->
<div class="sort-buttons">
    <button class="sort-btn {% if current_sort == 'date_added' %}active{% endif %}"
            onclick="location.href='?sort=date_added'">
        üìÖ –ü–æ –¥–∞—Ç–µ
    </button>
    <button class="sort-btn {% if current_sort == 'original' %}active{% endif %}"
            onclick="location.href='?sort=original'">
        üî§ –ü–æ —Å–ª–æ–≤—É
    </button>
    <button class="sort-btn {% if current_sort == 'translation' %}active{% endif %}"
            onclick="location.href='?sort=translation'">
        üî§ –ü–æ –ø–µ—Ä–µ–≤–æ–¥—É
    </button>
    <button class="sort-btn {% if current_sort == 'level' %}active{% endif %}"
            onclick="location.href='?sort=level'">
        üìä –ü–æ —É—Ä–æ–≤–Ω—é
    </button>
    <button class="sort-btn {% if current_sort == 'next_review' %}active{% endif %}"
            onclick="location.href='?sort=next_review'">
        ‚è∞ –ü–æ –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏—é
    </button>
</div>

<!-- –¢–∞–±–ª–∏—Ü–∞ —Å–ª–æ–≤ -->
<table class="words-table">
    <thead>
        <tr>
            <th>–°–ª–æ–≤–æ</th>
            <th>–ó–≤—É–∫</th>  <!-- –ù–û–í–ê–Ø –ö–û–õ–û–ù–ö–ê –û–ó–í–£–ß–ö–ò -->
            <th>–¢—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏—è</th>
            <th>–ü–µ—Ä–µ–≤–æ–¥</th>
            <th>–ü—Ä–æ–≥—Ä–µ—Å—Å</th>
            <th>–°–ª–µ–¥. –ø–æ–≤—Ç–æ—Ä</th>
            <th>–î–µ–π—Å—Ç–≤–∏—è</th>
        </tr>
    </thead>
    <tbody>
        {% for user_word in user_words %}
        <tr>
            <td><strong>{{ user_word.word.original }}</strong></td>
            <td>
                <!-- –ö–ù–û–ü–ö–ê –û–ó–í–£–ß–ö–ò - –î–û–ë–ê–í–õ–ï–ù–û -->
                <button class="tts-btn" onclick="playWordAudio({{ user_word.word.id }})"
                        title="–û–∑–≤—É—á–∏—Ç—å —Å–ª–æ–≤–æ '{{ user_word.word.original }}'">
                    üîä
                </button>
            </td>
            <td>{{ user_word.word.transcription|default:"-" }}</td>
            <td>{{ user_word.word.translation }}</td>
            <td>
                {% if user_word.repetition == 0 %}
                    <span class="progress-badge progress-new">–ù–æ–≤–æ–µ</span>
                {% elif user_word.repetition < 4 %}
                    <span class="progress-badge progress-learning">–ò–∑—É—á–∞–µ—Ç—Å—è</span>
                {% else %}
                    <span class="progress-badge progress-learned">–ò–∑—É—á–µ–Ω–æ</span>
                {% endif %}
                ({{ user_word.repetition }})
            </td>
            <td>{{ user_word.next_review|date:"d.m.Y" }}</td>
            <td>
                <div class="action-buttons">
                    <form method="post" action="{% url 'app_vocab:review_now' user_word.id %}" style="display: inline;">
                        {% csrf_token %}
                        <button type="submit" class="btn review-btn" title="–ü–æ–≤—Ç–æ—Ä–∏—Ç—å —Å–µ–π—á–∞—Å">
                            üïê
                        </button>
                    </form>
                    <form method="post" action="{% url 'app_vocab:remove_word' user_word.id %}" style="display: inline;">
                        {% csrf_token %}
                        <input type="hidden" name="current_sort" value="{{ current_sort }}">
                        <button type="submit" class="btn delete-btn"
                                onclick="return confirm('–£–¥–∞–ª–∏—Ç—å —Å–ª–æ–≤–æ ¬´{{ user_word.word.original }}¬ª –∏–∑ –≤–∞—à–µ–≥–æ —Å–ª–æ–≤–∞—Ä—è?')"
                                title="–£–¥–∞–ª–∏—Ç—å —Å–ª–æ–≤–æ">
                            üóëÔ∏è
                        </button>
                    </form>
                </div>
            </td>
        </tr>
        {% empty %}
        <tr>
            <td colspan="7" style="text-align: center; padding: 40px; color: #666;">
                <h3>üìù –í–∞—à —Å–ª–æ–≤–∞—Ä—å –ø—É—Å—Ç</h3>
                <p>–î–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–≤—ã–µ —Å–ª–æ–≤–∞, —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å –æ–±—É—á–µ–Ω–∏–µ!</p>
                <a href="{% url 'app_vocab:add_word' %}" class="add-btn" style="margin-top: 15px;">
                    ‚ûï –î–æ–±–∞–≤–∏—Ç—å –ø–µ—Ä–≤–æ–µ —Å–ª–æ–≤–æ
                </a>
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>

<!-- –ë–ª–æ–∫ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Å–ª–æ–≤–∞ -->
<div class="add-word-section">
    <h3>–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–µ —Å–ª–æ–≤–∞</h3>
    <p>–†–∞—Å—à–∏—Ä—è–π—Ç–µ —Å–≤–æ–π —Å–ª–æ–≤–∞—Ä–Ω—ã–π –∑–∞–ø–∞—Å, –¥–æ–±–∞–≤–ª—è—è –Ω–æ–≤—ã–µ —Å–ª–æ–≤–∞ –∏ –≤—ã—Ä–∞–∂–µ–Ω–∏—è</p>
    <a href="{% url 'app_vocab:add_word' %}" class="add-btn">
        ‚ûï –î–æ–±–∞–≤–∏—Ç—å —Å–ª–æ–≤–æ
    </a>
</div>

<script>
// –§–£–ù–ö–¶–ò–Ø –û–ó–í–£–ß–ö–ò - –î–û–ë–ê–í–õ–ï–ù–û
function playWordAudio(wordId) {
    const button = event.target;
    const originalHTML = button.innerHTML;
    button.innerHTML = '‚è≥';
    button.disabled = true;

    fetch(`/generate-audio/${wordId}/`)
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                const audio = new Audio(data.audio_url);
                audio.play();

                // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∫–Ω–æ–ø–∫—É –ø–æ—Å–ª–µ –æ–∫–æ–Ω—á–∞–Ω–∏—è –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è
                audio.onended = function() {
                    button.innerHTML = originalHTML;
                    button.disabled = false;
                };

                // –¢–∞–∫–∂–µ –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —á–µ—Ä–µ–∑ 5 —Å–µ–∫—É–Ω–¥ –Ω–∞ —Å–ª—É—á–∞–π –æ—à–∏–±–∫–∏
                setTimeout(() => {
                    button.innerHTML = originalHTML;
                    button.disabled = false;
                }, 5000);

            } else {
                alert('–û—à–∏–±–∫–∞ –æ–∑–≤—É—á–∫–∏: ' + data.error);
                button.innerHTML = originalHTML;
                button.disabled = false;
            }
        })
        .catch(error => {
            console.error('Error:', error);
            alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∞—É–¥–∏–æ');
            button.innerHTML = originalHTML;
            button.disabled = false;
        });
}
</script>
{% endblock %}